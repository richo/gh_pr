#!/bin/sh

# Script to open a browser to current branch
# Repo formats:
# ssh   git@github.com:richoH/gh_pr.git
# http  https://richoH@github.com/richoH/gh_pr.git
# git   git://github.com/richoH/gh_pr.git

get_repo() {
    # TODO Work out which repo is ours and which is upstream?
    git remote -v | while read remote; do
      if repo=`echo $remote | grep -E -o "git@github.com:[^ ]*"`; then
          echo $repo | sed -e "s/^git@github\.com//" -e "s/:/\//" -e "s/\.git$//"
          break
      fi
      if repo=`echo $remote | grep -E -o "https?://([^@]*@)?github.com/[^ ]*\.git"`; then
          echo $repo | sed -e "s|^https?://||" -e "s/^.*github\.com\///" -e "s/\.git$//"
          break
      fi
      if repo=`echo $remote | grep -E -o "git://github.com/[^ ]*\.git"`; then
          echo $repo | sed -e "s|^git://github.com/||" -e "s/\.git$//"
          break
      fi
    done
}

repo=`get_repo`
# This is kludge, but seems easiest
branch=`git symbolic-ref HEAD 2>/dev/null`
branch=${branch##refs/heads/}

url="http://github.com/$repo/pull/new/$branch"

echo $url
